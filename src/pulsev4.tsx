import React, { useState } from 'react'

const Pulsev4 = () => {
    const [subDoshasAnsList, setsubDoshasAnsList] = useState<any>(
        {
            "18": [
                {
                    "sub_questionId": 18,
                    "sub_optionIdL1": [
                        {
                            "A1": 115
                        },
                        {
                            "B1": 118
                        },
                        {
                            "C1": 120
                        },
                        {
                            "G1": 127
                        },
                        {
                            "F1": 126
                        },
                        {
                            "E1": 124
                        },
                        {
                            "J1": 134
                        },
                        {
                            "I1": 132
                        }
                    ]
                }
            ],
            "19": [
                {
                    "sub_questionId": 19,
                    "sub_optionIdL1": [
                        {
                            "A1": 115
                        },
                        {
                            "B1": 118
                        },
                        {
                            "C1": 120
                        },
                        {
                            "E1": 123
                        },
                        {
                            "D1": 121
                        },
                        {
                            "F1": 126
                        },
                        {
                            "H1": 130
                        },
                        {
                            "I1": 131
                        }
                    ]
                }
            ],
            "20": [
                {
                    "sub_questionId": 20,
                    "sub_optionIdL1": [
                        {
                            "A1": 115
                        },
                        {
                            "B1": 118
                        },
                        {
                            "C1": 120
                        },
                        {
                            "I1": 132
                        },
                        {
                            "J1": 134
                        },
                        {
                            "H1": 129
                        },
                        {
                            "G1": 127
                        },
                        {
                            "E1": 123
                        },
                        {
                            "F1": 125
                        }
                    ]
                }
            ],
            "21": [
                {
                    "sub_questionId": 21,
                    "sub_optionIdL1": [
                        {
                            "A1": 115
                        },
                        {
                            "B1": 118
                        },
                        {
                            "C1": 120
                        },
                        {
                            "D1": 122
                        },
                        {
                            "E1": 124
                        },
                        {
                            "F1": 126
                        },
                        {
                            "G1": 128
                        },
                        {
                            "H1": 130
                        },
                        {
                            "I1": 132
                        },
                        {
                            "J1": 134
                        }
                    ]
                }
            ],
            "22": [
                {
                    "sub_questionId": 22,
                    "sub_optionIdL1": [
                        {
                            "A1": 115
                        },
                        {
                            "B1": 118
                        },
                        {
                            "C1": 120
                        },
                        {
                            "I1": 132
                        },
                        {
                            "H1": 129
                        },
                        {
                            "G1": 127
                        },
                        {
                            "E1": 124
                        },
                        {
                            "D1": 122
                        }
                    ]
                }
            ],
            "23": [
                {
                    "sub_questionId": 23,
                    "sub_optionIdL1": [
                        {
                            "D1": 122
                        },
                        {
                            "E1": 124
                        },
                        {
                            "F1": 126
                        },
                        {
                            "A1": 116
                        },
                        {
                            "B1": 118
                        },
                        {
                            "C1": 120
                        },
                        {
                            "G1": 128
                        },
                        {
                            "H1": 130
                        },
                        {
                            "I1": 132
                        }
                    ]
                }
            ],
            "24": [
                {
                    "sub_questionId": 24,
                    "sub_optionIdL1": [
                        {
                            "D1": 122
                        },
                        {
                            "E1": 124
                        },
                        {
                            "F1": 126
                        },
                        {
                            "A1": 116
                        },
                        {
                            "B1": 118
                        },
                        {
                            "C1": 120
                        },
                        {
                            "G1": 128
                        },
                        {
                            "H1": 130
                        },
                        {
                            "I1": 132
                        }
                    ]
                }
            ],
            "25": [
                {
                    "sub_questionId": 25,
                    "sub_optionIdL1": [
                        {
                            "D1": 122
                        },
                        {
                            "E1": 124
                        },
                        {
                            "F1": 126
                        },
                        {
                            "A1": 116
                        },
                        {
                            "B1": 118
                        },
                        {
                            "C1": 120
                        },
                        {
                            "G1": 128
                        },
                        {
                            "H1": 130
                        },
                        {
                            "I1": 132
                        }
                    ]
                }
            ],
            "26": [
                {
                    "sub_questionId": 26,
                    "sub_optionIdL1": [
                        {
                            "D1": 122
                        },
                        {
                            "E1": 124
                        },
                        {
                            "F1": 126
                        },
                        {
                            "A1": 116
                        },
                        {
                            "B1": 118
                        },
                        {
                            "C1": 120
                        },
                        {
                            "G1": 128
                        },
                        {
                            "H1": 130
                        },
                        {
                            "I1": 132
                        }
                    ]
                }
            ],
            "27": [
                {
                    "sub_questionId": 27,
                    "sub_optionIdL1": [
                        {
                            "D1": 122
                        },
                        {
                            "E1": 124
                        },
                        {
                            "F1": 126
                        },
                        {
                            "A1": 116
                        },
                        {
                            "B1": 118
                        },
                        {
                            "C1": 120
                        },
                        {
                            "G1": 128
                        },
                        {
                            "H1": 130
                        },
                        {
                            "I1": 132
                        }
                    ]
                }
            ],
            "28": [
                {
                    "sub_questionId": 28,
                    "sub_optionIdL1": [
                        {
                            "G1": 128
                        },
                        {
                            "H1": 130
                        },
                        {
                            "I1": 132
                        },
                        {
                            "A1": 116
                        },
                        {
                            "B1": 118
                        },
                        {
                            "C1": 120
                        },
                        {
                            "D1": 122
                        }
                    ]
                }
            ],
            "29": [
                {
                    "sub_questionId": 29,
                    "sub_optionIdL1": [
                        {
                            "G1": 128
                        },
                        {
                            "H1": 130
                        },
                        {
                            "I1": 132
                        },
                        {
                            "A1": 116
                        },
                        {
                            "B1": 118
                        },
                        {
                            "C1": 120
                        },
                        {
                            "D1": 122
                        },
                        {
                            "J1": 133
                        }
                    ]
                }
            ],
            "30": [
                {
                    "sub_questionId": 30,
                    "sub_optionIdL1": [
                        {
                            "G1": 128
                        },
                        {
                            "H1": 130
                        },
                        {
                            "I1": 132
                        },
                        {
                            "A1": 116
                        },
                        {
                            "B1": 118
                        },
                        {
                            "C1": 120
                        },
                        {
                            "D1": 122
                        }
                    ]
                }
            ],
            "31": [
                {
                    "sub_questionId": 31,
                    "sub_optionIdL1": [
                        {
                            "G1": 128
                        },
                        {
                            "H1": 130
                        },
                        {
                            "I1": 132
                        },
                        {
                            "A1": 116
                        },
                        {
                            "B1": 118
                        },
                        {
                            "C1": 120
                        },
                        {
                            "D1": 122
                        }
                    ]
                }
            ],
            "32": [
                {
                    "sub_questionId": 32,
                    "sub_optionIdL1": [
                        {
                            "G1": 128
                        },
                        {
                            "H1": 130
                        },
                        {
                            "I1": 132
                        },
                        {
                            "A1": 116
                        },
                        {
                            "B1": 118
                        },
                        {
                            "C1": 120
                        },
                        {
                            "D1": 122
                        }
                    ]
                }
            ]
        }
    );

    const subDoshaList = [
        {
            "pulseQuestionId": 5,
            "pulseQuestionName": "Sub Dosha",
            "pulseOptionsList": [
                {
                    "pulseOptionId": 18,
                    "pulseOptionName": "Prana",
                    "doshas": "Vata",
                    "uniqueKey": null
                },
                {
                    "pulseOptionId": 19,
                    "pulseOptionName": "Udana",
                    "doshas": "Vata",
                    "uniqueKey": null
                },
                {
                    "pulseOptionId": 20,
                    "pulseOptionName": "Samana",
                    "doshas": "Vata",
                    "uniqueKey": null
                },
                {
                    "pulseOptionId": 21,
                    "pulseOptionName": "Apana",
                    "doshas": "Vata",
                    "uniqueKey": null
                },
                {
                    "pulseOptionId": 22,
                    "pulseOptionName": "Vyana",
                    "doshas": "Vata",
                    "uniqueKey": null
                },
                {
                    "pulseOptionId": 23,
                    "pulseOptionName": "Pachaka",
                    "doshas": "Pitta",
                    "uniqueKey": null
                },
                {
                    "pulseOptionId": 24,
                    "pulseOptionName": "Ranjaka",
                    "doshas": "Pitta",
                    "uniqueKey": null
                },
                {
                    "pulseOptionId": 25,
                    "pulseOptionName": "Sadhaka",
                    "doshas": "Pitta",
                    "uniqueKey": null
                },
                {
                    "pulseOptionId": 26,
                    "pulseOptionName": "Alochaka",
                    "doshas": "Pitta",
                    "uniqueKey": null
                },
                {
                    "pulseOptionId": 27,
                    "pulseOptionName": "Brajaka",
                    "doshas": "Pitta",
                    "uniqueKey": null
                },
                {
                    "pulseOptionId": 28,
                    "pulseOptionName": "kledaka",
                    "doshas": "Kapha",
                    "uniqueKey": null
                },
                {
                    "pulseOptionId": 29,
                    "pulseOptionName": "Avalambaka",
                    "doshas": "Kapha",
                    "uniqueKey": null
                },
                {
                    "pulseOptionId": 30,
                    "pulseOptionName": "Bhodaka",
                    "doshas": "Kapha",
                    "uniqueKey": null
                },
                {
                    "pulseOptionId": 31,
                    "pulseOptionName": "Tarpaka",
                    "doshas": "Kapha",
                    "uniqueKey": null
                },
                {
                    "pulseOptionId": 32,
                    "pulseOptionName": "Sleshaka",
                    "doshas": "Kapha",
                    "uniqueKey": null
                }
            ]
        }
    ]


    const groupedData: any = {
        "A1": [
            {
                "pulseOptionId": 115,
                "pulseOptionName": "Sticky",
                "doshas": null,
                "uniqueKey": "A1"
            },
            {
                "pulseOptionId": 116,
                "pulseOptionName": "Clear",
                "doshas": null,
                "uniqueKey": "A1"
            }
        ],
        "B1": [
            {
                "pulseOptionId": 117,
                "pulseOptionName": "Dull",
                "doshas": null,
                "uniqueKey": "B1"
            },
            {
                "pulseOptionId": 118,
                "pulseOptionName": "Sharp",
                "doshas": null,
                "uniqueKey": "B1"
            }
        ],
        "C1": [
            {
                "pulseOptionId": 119,
                "pulseOptionName": "Heavy",
                "doshas": null,
                "uniqueKey": "C1"
            },
            {
                "pulseOptionId": 120,
                "pulseOptionName": "Light",
                "doshas": null,
                "uniqueKey": "C1"
            }
        ],
        "D1": [
            {
                "pulseOptionId": 121,
                "pulseOptionName": "Soft",
                "doshas": null,
                "uniqueKey": "D1"
            },
            {
                "pulseOptionId": 122,
                "pulseOptionName": "Hard",
                "doshas": null,
                "uniqueKey": "D1"
            }
        ],
        "E1": [
            {
                "pulseOptionId": 123,
                "pulseOptionName": "Cold",
                "doshas": null,
                "uniqueKey": "E1"
            },
            {
                "pulseOptionId": 124,
                "pulseOptionName": "Hot",
                "doshas": null,
                "uniqueKey": "E1"
            }
        ],
        "F1": [
            {
                "pulseOptionId": 125,
                "pulseOptionName": "Subtle",
                "doshas": null,
                "uniqueKey": "F1"
            },
            {
                "pulseOptionId": 126,
                "pulseOptionName": "Gross",
                "doshas": null,
                "uniqueKey": "F1"
            }
        ],
        "G1": [
            {
                "pulseOptionId": 127,
                "pulseOptionName": "Moving",
                "doshas": null,
                "uniqueKey": "G1"
            },
            {
                "pulseOptionId": 128,
                "pulseOptionName": "Stable",
                "doshas": null,
                "uniqueKey": "G1"
            }
        ],
        "H1": [
            {
                "pulseOptionId": 129,
                "pulseOptionName": "Slightly Oily",
                "doshas": null,
                "uniqueKey": "H1"
            },
            {
                "pulseOptionId": 130,
                "pulseOptionName": "Dry",
                "doshas": null,
                "uniqueKey": "H1"
            }
        ],
        "I1": [
            {
                "pulseOptionId": 131,
                "pulseOptionName": "Flowing",
                "doshas": null,
                "uniqueKey": "I1"
            },
            {
                "pulseOptionId": 132,
                "pulseOptionName": "Dense",
                "doshas": null,
                "uniqueKey": "I1"
            }
        ],
        "J1": [
            {
                "pulseOptionId": 133,
                "pulseOptionName": "Smooth",
                "doshas": null,
                "uniqueKey": "J1"
            },
            {
                "pulseOptionId": 134,
                "pulseOptionName": "Rough",
                "doshas": null,
                "uniqueKey": "J1"
            }
        ],
        "K1": [
            {
                "pulseOptionId": 135,
                "pulseOptionName": "Covered",
                "doshas": null,
                "uniqueKey": "K1"
            }
        ],
        "L1": [
            {
                "pulseOptionId": 136,
                "pulseOptionName": "Pleasant",
                "doshas": null,
                "uniqueKey": "L1"
            }
        ]
    }

    const surfaceAnsList = (questionId: string, optionId: string, uniqueKey: string) => {
        setsubDoshasAnsList((prevData: any) => {
            const updatedData = { ...prevData };
            const key = questionId === "5" ? "subDoshaAnsList" : questionId;
            if (!updatedData[key]) {
                updatedData[key] = [];
            }
            const index = updatedData[key].findIndex((item: any) => item.sub_questionId === parseInt(questionId));
            if (index === -1) {
                updatedData[key].push({
                    sub_questionId: parseInt(questionId),
                    sub_optionIdL1: [{ [uniqueKey]: parseInt(optionId) }],
                });
            } else {
                const sub_optionIdL1Index = updatedData[key][index].sub_optionIdL1.findIndex((item: {}) =>
                    Object.keys(item)[0] === uniqueKey
                );
                if (sub_optionIdL1Index === -1) {
                    updatedData[key][index].sub_optionIdL1.push({ [uniqueKey]: parseInt(optionId) });
                } else {
                    updatedData[key][index].sub_optionIdL1[sub_optionIdL1Index][uniqueKey] = parseInt(optionId);
                }
            }
            return updatedData;
        });
    };




    // ... (previous code)

    console.log(subDoshasAnsList)

    // const clearForm = () => {
    //     setsubDoshasAnsList((prevData: any) => {
    //         const updatedData = { ...prevData };
    //         const subQuestionIdsToClear = [18, 19, 20, 21, 22];
    //         subQuestionIdsToClear.forEach((subQuestionId) => {
    //             const key = subQuestionId.toString();
    //             if (updatedData[key]) {
    //                 updatedData[key] = [];
    //             }
    //         });
    //         return updatedData;
    //     });
    // };

    // ... (previous code)

    // Clear Form Functionality
    // const clearForm = () => {
    //     setsubDoshasAnsList((prevData: any) => {
    //         const updatedData = { ...prevData };
    //         Object.keys(updatedData).forEach((key) => {
    //             updatedData[key] = [];
    //         });
    //         return updatedData;
    //     });
    // };

    const clearForm = () => {
        const elementsToRemove = ['18', '19', '20', '21', '22'];

        // Update subDoshasAnsList state by filtering out the elements to be removed
        setsubDoshasAnsList((prevList: any) => {
            const updatedList = { ...prevList };
            elementsToRemove.forEach((element) => {
                delete updatedList[element];
            });
            return updatedList;
        });
    }

    // const clearForm = () => {

    //     setsubDoshasAnsList({});


    // };
    // ... (remaining code)

    return (

        <>
            <div>
                <button onClick={clearForm} className="bg-red-500 text-white p-2 rounded-md">
                    Clear Form
                </button>
                {subDoshaList?.map((tile: any, tileIndex: any) => (
                    <div key={tileIndex} className="rounded-md">
                        <div className="grid grid-cols-5 gap-4 my-2">
                            {Array.isArray(tile.pulseOptionsList) && tile.pulseOptionsList
                                ?.filter((option: any) => option.doshas === 'Vata')
                                ?.map((option: any, index: any) => (
                                    <div key={index}>
                                        <label className='p-5 bg-[#DBD6C9] rounded-xl flex justify-center font-semibold text-[#5B5236]'>
                                            {option.pulseOptionName}
                                        </label>
                                        <div className='text-2xl'>
                                            {Object.keys(groupedData).map(key => {
                                                const groupOptions = (groupedData as any)[key];
                                                const isSingleOption = groupOptions.length === 1;
                                                return (
                                                    <div className={!isSingleOption ? "bg-white rounded-md shadow-md" : 'hidden'} key={key}>
                                                        <div className="p-4 flex flex-col flex-wrap gap-4 m-3">
                                                            {(groupedData as any)[key].map((optionR: any) => {


                                                                // const selectedOptions = subDoshasAnsList && subDoshasAnsList[option.pulseOptionId]?.[0]?.sub_optionIdL1;
                                                                return (
                                                                    <div key={optionR.pulseOptionId} className=' flex items-center'>
                                                                        {/* <input
                                                                            type="radio"
                                                                            name={optionR.uniqueKey + '_' + option.pulseOptionName}
                                                                            value={optionR.pulseOptionId}
                                                                            id={`${option.pulseOptionName}_${optionR.pulseOptionId}`}
                                                                            // checked={selectedOptions?.some(
                                                                            //     (selectedOption: any) =>
                                                                            //         selectedOption[optionR.uniqueKey] === optionR.pulseOptionId
                                                                            // )}
                                                                            checked={
                                                                                subDoshasAnsList &&
                                                                                subDoshasAnsList[option.pulseOptionId]?.[0]?.sub_optionIdL1.some(
                                                                                    (selectedOption: any) => selectedOption[optionR.uniqueKey] === optionR.pulseOptionId
                                                                                )
                                                                            }
                                                                            className='w-5 accent-brown2'
                                                                            onChange={(e) => {
                                                                                surfaceAnsList(
                                                                                    option.pulseOptionId.toString(),
                                                                                    e?.target?.value,
                                                                                    optionR.uniqueKey
                                                                                );
                                                                            }}
                                                                        /> */}
                                                                        <input
                                                                            type="radio"
                                                                            name={optionR.uniqueKey + '_' + option.pulseOptionName}
                                                                            value={optionR.pulseOptionId}
                                                                            id={`${option.pulseOptionName}_${optionR.pulseOptionId}`}
                                                                            checked={
                                                                                subDoshasAnsList &&
                                                                                subDoshasAnsList[option.pulseOptionId]?.[0]?.sub_optionIdL1.some(
                                                                                    (selectedOption: any) => selectedOption[optionR.uniqueKey] === optionR.pulseOptionId
                                                                                ) || false
                                                                            }
                                                                            className='w-5 accent-brown2'
                                                                            onChange={(e) => {
                                                                                surfaceAnsList(
                                                                                    option.pulseOptionId.toString(),
                                                                                    e?.target?.value,
                                                                                    optionR.uniqueKey
                                                                                );
                                                                            }}
                                                                        />

                                                                        <label htmlFor={`${option.pulseOptionName}_${optionR.pulseOptionId}`} className='text-sm text-headingTextColor font-semibold'>
                                                                            {optionR.pulseOptionName}
                                                                        </label>
                                                                    </div>
                                                                );
                                                            })}
                                                        </div>
                                                    </div>)
                                            })}

                                        </div>
                                    </div>
                                ))}
                        </div>
                    </div>
                ))}
            </div>
        </>
    );


}

export default Pulsev4